#!/bin/python

import numpy as np
import dronekit as dk
import multiprocessing as mp
import boat

cfg = np.loadtxt('../config/boat.cfg')

lock = mp.Lock()
apm = dk.connect('/dev/ttyACM0', wait_ready=True, baud=115200)

apm.parameters['RUDDER_MID'] = cfg[0]
print("RUDDER_MID",apm.parameters['RUDDER_MID'])

apm.parameters['SAIL_MID'] = cfg[1]
print("SAIL_MID",apm.parameters['SAIL_MID'])

apm.mode = 'MANUAL'
print(apm.mode)

lp = boat.LogProcess(lock,apm)
cp = boat.CameraProcess(lock)

lp.start()
cp.start()

lp.join()
cp.join()
